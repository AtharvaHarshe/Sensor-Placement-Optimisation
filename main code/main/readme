this has the main code pipeline
